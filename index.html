<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Остродоставка - Доставка продуктов в Острогожске</title>
  <meta name="description" content="Доставка продуктов на дом в Острогожске. Быстро, надежно, доступно!">
  <meta name="keywords" content="доставка продуктов, Острогожск, курьерская служба, Остродоставка">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', Arial, sans-serif; background-color: #f5f5f5; color: #333; min-height: 100vh; display: flex; flex-direction: column; }
    nav { position: fixed; top: 0; width: 100%; background-color: #2e7d32; display: flex; justify-content: space-around; padding: 0.5rem 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    nav a { color: white; text-decoration: none; font-size: 0.9rem; padding: 0.5rem 1rem; writing-mode: vertical-rl; text-orientation: mixed; height: 80px; display: flex; align-items: center; justify-content: center; width: 25%; transition: background 0.3s; }
    nav a:hover { background-color: #388e3c; border-radius: 5px; }
    header { background-color: #2e7d32; color: white; text-align: center; padding: 1.5rem; margin-top: 80px; }
    .container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; flex: 1; }
    .categories { margin-bottom: 1.5rem; }
    .category-item { background: #e0e0e0; border-radius: 8px; margin-bottom: 0.5rem; cursor: pointer; padding: 0.75rem; }
    .category-item h3 { display: flex; align-items: center; gap: 0.5rem; }
    .category-item h3 img { width: 1.25rem; height: 1.25rem; }
    .category-item .products { display: none; padding: 1rem 0; }
    .category-item.active .products { display: block; }
    .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
    .product { background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 1rem; text-align: center; transition: transform 0.3s; }
    .product:hover { transform: translateY(-5px); }
    .product img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; background: #eee; loading: lazy; }
    .product h3 { font-size: 1rem; margin: 0.5rem 0; }
    .product .description { font-size: 0.9rem; color: #666; margin: 0.5rem 0; }
    .product .price { font-size: 1.2rem; color: #d32f2f; }
    .product button { background-color: #4caf50; color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer; width: 100%; transition: background 0.3s; }
    .product button:hover { background-color: #388e3c; }
    .filters { margin-bottom: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap; }
    .filters input, .filters select { padding: 0.5rem; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; }
    .cart, .order-form { margin-top: 2rem; background: #e8f5e9; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .cart h2, .order-form h2 { margin-top: 0; }
    .cart ul { list-style: none; padding: 0; margin: 0; }
    .cart li { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #ddd; }
    .cart li button { background-color: #ff4443; color: white; border: none; padding: 0.3rem 0.6rem; border-radius: 5px; cursor: pointer; }
    .cart li button:hover { background-color: #cc0000; }
    .cart .total { font-size: 1.1rem; font-weight: bold; margin-top: 1rem; }
    .cart .total span { color: #d32f2f; }
    .cart button, .order-form button { background-color: #4caf50; color: white; border: none; padding: 0.75rem; border-radius: 5px; cursor: pointer; width: 100%; font-size: 1rem; }
    .cart button:hover, .order-form button:hover { background-color: #388e3c; }
    .order-form { display: none; }
    .order-form .input-group { margin-bottom: 1rem; }
    .order-form label { font-weight: bold; display: block; margin-bottom: 0.3rem; }
    .order-form input, .order-form select { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; }
    footer { background-color: #2e7d32; color: white; text-align: center; padding: 1rem; }
    @media (max-width: 768px) {
      .products { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
      nav { flex-direction: row; padding: 0.25rem 0; }
      nav a { padding: 0.25rem 0.5rem; height: 60px; font-size: 0.8rem; }
    }
  </style>
</head>
<body>
  <nav>
    <a href="#catalog">Каталог</a>
    <a href="#cart">Корзина</a>
    <a href="#contact">Контакты</a>
    <a onclick="showAdminLogin()">Админ</a>
  </nav>
  <header>
    <h1>Остродоставка</h1>
    <p>Доставка продуктов по Острогожску прямо к вашему дому!</p>
  </header>
  <div class="container">
    <div class="filters">
      <input type="text" id="search" placeholder="Поиск по названию..." oninput="filterProducts()">
      <select id="priceFilter" onchange="filterProducts()">
        <option value="">Все цены</option>
        <option value="0-50">До 50 ₽</option>
        <option value="50-100">50-100 ₽</option>
        <option value="100+">Свыше 100 ₽</option>
      </select>
    </div>
    <section id="catalog">
      <h2>Каталог товаров</h2>
      <div class="categories" id="category-list"></div>
    </section>
    <section id="cart" class="cart">
      <h2>Ваша корзина</h2>
      <ul id="cart-list"></ul>
      <div class="total">
        Товары: <span id="subtotal">0</span> ₽<br>
        Доставка: <span id="delivery">200</span> ₽<br>
        Итого: <span id="total">200</span> ₽
      </div>
      <button onclick="showOrderForm()">Оформить заказ</button>
    </section>
    <section id="order" class="order-form">
      <h2>Оформление заказа</h2>
      <form id="order-form">
        <div class="input-group">
          <label for="name">Имя:</label>
          <input type="text" id="name" required>
        </div>
        <div class="input-group">
          <label for="phone">Телефон:</label>
          <input type="tel" id="phone" required>
        </div>
        <div class="input-group">
          <label for="address">Адрес доставки:</label>
          <input type="text" id="address" required>
        </div>
        <div class="input-group">
          <label for="payment-method">Способ оплаты:</label>
          <select id="payment-method" required>
            <option value="cash">Наличными</option>
            <option value="online">Онлайн (картой)</option>
          </select>
        </div>
        <button type="submit">Подтвердить заказ</button>
      </form>
    </section>
    <section id="contact">
      <h2>Контакты</h2>
      <p>Телефон: <a href="tel:+79991234567">+7 (999) 123-45-67</a></p>
      <p>Email: <a href="mailto:support@ostrodostavka.ru">support@ostrodostavka.ru</a></p>
      <p>WhatsApp: <a href="https://wa.me/79991234567">+7 (999) 123-45-67</a></p>
    </section>
  </div>
  <footer>
    <p>© 2025 Остродоставка. Все права защищены.</p>
  </footer>

  <div id="admin-modal" class="modal">
    <div class="modal-content">
      <button class="close" onclick="closeModal()">×</button>
      <div id="admin-login" class="admin-login">
        <h2>Вход в админ-панель</h2>
        <div class="input-group">
          <input type="password" id="admin-password" placeholder="Введите пароль">
        </div>
        <button onclick="loginAdmin()">Войти</button>
      </div>
      <div id="admin-content" class="admin-content" style="display: none;">
        <h2>Админ-панель</h2>
        <div class="buttons">
          <button onclick="showSection('add-product')">Добавление товара</button>
          <button onclick="showSection('product-list')">Список товаров</button>
          <button onclick="showSection('employee-list')">База сотрудников</button>
          <button onclick="showSection('order-data')">Данные заказов</button>
        </div>
        <div id="add-product" class="admin-section">
          <h3>Добавление товара</h3>
          <form id="add-product-form">
            <div class="input-group">
              <label for="product-name">Название:</label>
              <input type="text" id="product-name" required>
            </div>
            <div class="input-group">
              <label for="product-description">Описание:</label>
              <input type="text" id="product-description">
            </div>
            <div class="input-group">
              <label for="product-price">Цена (₽):</label>
              <input type="number" id="product-price" step="0.01" required>
            </div>
            <div class="input-group">
              <label for="product-image">Изображение:</label>
              <input type="file" id="product-image" accept="image/*">
            </div>
            <div class="input-group">
              <label for="product-category">Категория:</label>
              <select id="product-category" required>
                <option value="all">Все</option>
                <option value="молочная продукция">Молочная продукция</option>
                <option value="овощи и фрукты">Овощи и фрукты</option>
                <option value="хлебобулочные">Хлебобулочные</option>
                <option value="мясо и рыба">Мясо и рыба</option>
              </select>
            </div>
            <button type="submit">Добавить товар</button>
          </form>
        </div>
        <div id="product-list" class="admin-section">
          <h3>Список товаров</h3>
          <ul id="product-list-ul"></ul>
        </div>
        <div id="employee-list" class="admin-section">
          <h3>База сотрудников</h3>
          <ul id="employee-list-ul"></ul>
          <form id="add-employee-form">
            <div class="input-group">
              <label for="employee-name">ФИО:</label>
              <input type="text" id="employee-name" required>
            </div>
            <div class="input-group">
              <label for="employee-dob">Дата рождения:</label>
              <input type="date" id="employee-dob" required>
            </div>
            <div class="input-group">
              <label for="employee-position">Должность:</label>
              <input type="text" id="employee-position" required>
            </div>
            <div class="input-group">
              <label for="employee-address">Место проживания:</label>
              <input type="text" id="employee-address" required>
            </div>
            <div class="input-group">
              <label>Паспортные данные:</label>
              <div style="display: flex; gap: 1rem;">
                <input type="text" id="employee-passport-series" placeholder="Серия" required>
                <input type="text" id="employee-passport-number" placeholder="Номер" required>
              </div>
            </div>
            <div class="input-group">
              <label for="employee-phone">Номер телефона:</label>
              <input type="tel" id="employee-phone" required>
            </div>
            <button type="submit">Добавить сотрудника</button>
          </form>
        </div>
        <div id="order-data" class="admin-section">
          <h3>Данные заказов</h3>
          <ul id="order-list"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    const DELIVERY_COST = 200;
    const ADMIN_PASSWORD = 'admin123';
    const TELEGRAM_BOT_TOKEN = '7938614030:AAHeLLDp6k7u_kLPQorCoKTQ384tf8f1gTI';
    const TELEGRAM_CHAT_ID = '5154619540';

    let products = [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let employees = JSON.parse(localStorage.getItem('employees')) || [
      { id: 1, name: 'Иванов Иван Иванович', dob: '1990-05-15', position: 'Курьер', address: 'г. Острогожск, ул. Ленина, 10', passport: { series: '1234', number: '567890' }, phone: '+79991234567' }
    ];
    let orders = JSON.parse(localStorage.getItem('orders')) || [];

    const getImageUrl = (file) => new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (e) => resolve(e.target.result);
      reader.readAsDataURL(file);
    });

    const showModal = () => document.getElementById('admin-modal').style.display = 'block';
    const closeModal = () => document.getElementById('admin-modal').style.display = 'none';
    const showAdminLogin = () => {
      document.getElementById('admin-login').style.display = 'block';
      document.getElementById('admin-content').style.display = 'none';
      showModal();
    };
    const loginAdmin = () => {
      const password = document.getElementById('admin-password').value;
      if (password === ADMIN_PASSWORD) {
        document.getElementById('admin-login').style.display = 'none';
        document.getElementById('admin-content').style.display = 'block';
      } else alert('Неверный пароль!');
    };
    const showSection = (sectionId) => {
      document.querySelectorAll('.admin-section').forEach(section => section.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
      if (sectionId === 'product-list') renderProductList();
      if (sectionId === 'employee-list') renderEmployeeList();
      if (sectionId === 'order-data') renderOrderData();
    };

    async function loadProducts(category = 'all', offset = 0, limit = 20) {
      try {
        const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQP0tKq1V9eAd4ChTjREcujnQrSxaPBEfdWf1oquZxQeIH5gcwv2fv91TKYLmHEQdmtPfcaV5Y-l1Il/pub?gid=0&single=true&output=csv');
        const csvText = await response.text();
        const lines = csvText.split('\n').filter(line => line.trim());
        products = lines.slice(1).map(line => {
          const [id, name, description, price, category, image] = line.split(',');
          return { id: parseInt(id), name, description, price: parseFloat(price), category: category.trim().toLowerCase(), image: image || 'https://placehold.co/150x150' };
        }).filter(p => p.name);

        return category === 'all' ? products.slice(offset, offset + limit) : products.filter(p => p.category === category.toLowerCase()).slice(offset, offset + limit);
      } catch (error) {
        console.error('Ошибка загрузки данных:', error);
        return [];
      }
    }

    async function renderCategory(category) {
      const categoryDiv = document.querySelector(`#category-${category}`);
      if (!categoryDiv.classList.contains('active')) return;

      const productsDiv = categoryDiv.querySelector('.products');
      const offset = productsDiv.children.length;
      const newProducts = await loadProducts(category, offset, 20);

      if (newProducts.length > 0) {
        newProducts.forEach(product => {
          const div = document.createElement('div');
          div.className = 'product';
          div.innerHTML = `
            <img src="${product.image}" alt="${product.name}">
            <h3>${product.name}</h3>
            <div class="description">${product.description}</div>
            <div class="price">${product.price.toFixed(2)} ₽</div>
            <button onclick="addToCart(${product.id})">В корзину</button>
          `;
          productsDiv.appendChild(div);
        });
      }
    }

    function toggleCategory(category) {
      const categoryDiv = document.querySelector(`#category-${category}`);
      categoryDiv.classList.toggle('active');
      if (categoryDiv.classList.contains('active')) {
        renderCategory(category);
        window.addEventListener('scroll', handleScroll);
      } else {
        window.removeEventListener('scroll', handleScroll);
      }
    }

    function handleScroll() {
      const categoryDiv = document.querySelector('.category-item.active .products');
      if (categoryDiv && window.innerHeight + window.scrollY >= categoryDiv.offsetTop + categoryDiv.offsetHeight - 100) {
        const category = categoryDiv.closest('.category-item').id.replace('category-', '');
        renderCategory(category);
      }
    }

    function filterProducts() {
      const searchTerm = document.getElementById('search').value.toLowerCase();
      const priceRange = document.getElementById('priceFilter').value;
      document.querySelectorAll('.category-item').forEach(category => {
        const products = category.querySelectorAll('.product');
        products.forEach(product => {
          const nameMatch = product.querySelector('h3').textContent.toLowerCase().includes(searchTerm);
          const price = parseFloat(product.querySelector('.price').textContent);
          let priceMatch = true;
          if (priceRange) {
            const [min, max] = priceRange.split('-').map(Number) || [0, Infinity];
            priceMatch = price >= min && (max === Infinity ? price > min : price <= max);
          }
          product.style.display = nameMatch && priceMatch ? 'block' : 'none';
        });
      });
    }

    const addToCart = (id) => {
      const product = products.find(p => p.id === id);
      if (product) {
        const cartItem = cart.find(item => item.id === id);
        if (cartItem) cartItem.quantity = (cartItem.quantity || 1) + 1;
        else cart.push({ ...product, quantity: 1 });
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      }
    };

    const renderCart = () => {
      const list = document.getElementById('cart-list');
      list.innerHTML = '';
      let subtotal = 0;
      cart.forEach(item => {
        const totalPrice = item.price * (item.quantity || 1);
        subtotal += totalPrice;
        const li = document.createElement('li');
        li.innerHTML = `<span>${item.name} (x${item.quantity}) - ${totalPrice.toFixed(2)} ₽</span><button onclick="removeFromCart(${item.id})">Удалить</button>`;
        list.appendChild(li);
      });
      const total = subtotal + DELIVERY_COST;
      document.getElementById('subtotal').textContent = subtotal.toFixed(2);
      document.getElementById('total').textContent = total.toFixed(2);
    };

    const removeFromCart = (id) => {
      cart = cart.filter(item => item.id !== id);
      localStorage.setItem('cart', JSON.stringify(cart));
      renderCart();
    };

    const showOrderForm = () => document.getElementById('order').style.display = 'block';
    const submitOrder = async (e) => {
      e.preventDefault();
      const order = {
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        paymentMethod: document.getElementById('payment-method').value,
        cart,
        subtotal: parseFloat(document.getElementById('subtotal').textContent),
        delivery: DELIVERY_COST,
        total: parseFloat(document.getElementById('total').textContent),
        date: new Date().toISOString()
      };
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));

      const message = `Новый заказ:\nИмя: ${order.name}\nТелефон: ${order.phone}\nАдрес: ${order.address}\nОплата: ${order.paymentMethod}\nТовары: ${order.cart.map(item => `${item.name} (x${item.quantity}) - ${item.price * item.quantity} ₽`).join('\n')}\nСумма: ${order.subtotal} ₽\nДоставка: ${order.delivery} ₽\nИтого: ${order.total} ₽\nДата: ${new Date(order.date).toLocaleString()}`;
      await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message })
      });

      cart = []; localStorage.setItem('cart', JSON.stringify(cart));
      document.getElementById('order').style.display = 'none';
      document.getElementById('order-form').reset();
      renderCart();
      alert('Заказ успешно оформлен!');
    };

    const renderProductList = () => {
      const list = document.getElementById('product-list-ul');
      list.innerHTML = '';
      products.forEach(product => {
        const li = document.createElement('li');
        li.innerHTML = `<div class="product-info"><div><strong>Название:</strong> ${product.name}</div><div><strong>Описание:</strong> ${product.description}</div><div><strong>Цена:</strong> ${product.price.toFixed(2)} ₽</div><div><strong>Категория:</strong> ${product.category}</div><div><strong>Изображение:</strong> ${product.image}</div></div><div class="actions"><button onclick="showEditProductMenu(${product.id}, this)">Редактировать</button><button onclick="deleteProduct(${product.id})">Удалить</button></div>`;
        list.appendChild(li);
      });
    };

    const showEditProductMenu = (id, button) => { /* ... (оставлен без изменений для краткости) */ };
    const saveProduct = (id) => { /* ... */ };
    const deleteProduct = (id) => { /* ... */ };
    const closeEditMenu = (id) => { /* ... */ };
    const renderEmployeeList = () => { /* ... */ };
    const showEditEmployeeMenu = (id, button) => { /* ... */ };
    const saveEmployee = (id) => { /* ... */ };
    const deleteEmployee = (id) => { /* ... */ };
    const renderOrderData = () => { /* ... */ };

    document.getElementById('add-product-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const newProduct = {
        id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
        name: document.getElementById('product-name').value,
        description: document.getElementById('product-description').value,
        price: parseFloat(document.getElementById('product-price').value),
        category: document.getElementById('product-category').value,
        image: await getImageUrl(document.getElementById('product-image').files[0]) || 'https://placehold.co/150x150'
      };
      products.push(newProduct);
      localStorage.setItem('products', JSON.stringify(products));
      document.getElementById('add-product-form').reset();
      renderProductList();
      renderCategory(newProduct.category);
    });

    document.getElementById('add-employee-form').addEventListener('submit', (e) => { /* ... */ });

    document.addEventListener('DOMContentLoaded', async () => {
      renderCart();
      document.getElementById('order-form').addEventListener('submit', submitOrder);

      const categories = ['all', 'молочная продукция', 'овощи и фрукты', 'хлебобулочные', 'мясо и рыба'];
      const categoryList = document.getElementById('category-list');
      await loadProducts(); // Загружаем все продукты для фильтров
      categories.forEach(category => {
        const div = document.createElement('div');
        div.id = `category-${category}`;
        div.className = 'category-item';
        div.innerHTML = `<h3 onclick="toggleCategory('${category}')"><img src="https://img.icons8.com/ios-filled/20/000000/${category === 'all' ? 'discount' : category.split(' ')[0]}">${category === 'all' ? 'Все' : category}</h3><div class="products"></div>`;
        categoryList.appendChild(div);
      });
    });
  </script>
</body>
</html>
